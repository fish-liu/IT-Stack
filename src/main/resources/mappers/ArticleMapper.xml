<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.grow.demo.dao.IArticleDao">


    <insert id="save" parameterType="com.grow.demo.model.Article">
        insert into grow_article (content,img_ids,uid,cate_id,location,visibility,`status`,publish_time,create_time,update_time)
        values(#{content},#{imgIds},#{uid},#{cateId},#{location},#{visibility},#{status},#{publishTime},now(),now())
        <selectKey keyProperty="id" resultType="java.lang.Integer">
            select LAST_INSERT_ID() as id
        </selectKey>
    </insert>

    <update id="update" parameterType="com.grow.demo.model.Article">
        update grow_article set content = #{content},cate_id=${cateId}, visibility = #{visibility} ,publish_time = #{publishTime}, update_time = now()
        where id = #{id}
    </update>

    <update id="updateStatusById">
        update grow_article set status = #{status} , update_time = now() where id = #{id}
    </update>

    <delete id="deleteById" >
        update grow_article set status = 2 , update_time = now() where id = #{id}
    </delete>

    <!--<insert id="save" parameterType="com.ucarinc.framework.looker.server.model.OperationRecord">
        insert into looker_operation_record (instance_id,project_name,business_line,framework_version,ip,service_url,url,param,email,user_name,role,create_time)
        values(#{instanceId},#{projectName},#{businessLine},#{frameworkVersion},#{ip},#{serviceUrl},#{url},#{param},#{email},#{userName},#{role},#{createTime})
        <selectKey keyProperty="id" resultType="java.lang.Integer">
            select LAST_INSERT_ID() as id
        </selectKey>
    </insert>


    <select id="getList" resultType="com.ucarinc.framework.looker.server.model.OperationRecord" parameterType="java.util.Map">
        select id,instance_id instanceId,project_name projectName,business_line businessLine,framework_version frameworkVersion,ip,service_url serviceUrl,
              url, param,email, user_name userName, role ,create_time createTime
        from looker_operation_record
        where 1 = 1
        <if test="projectName != '' ">
            and project_name like '${projectName}%'
        </if>
        <if test="ip != '' ">
            and ip like '${ip}%'
        </if>
        order by create_time desc
        limit #{startPage} ,#{pageSize}
    </select>

    <select id="getListCount" resultType="java.lang.Integer" parameterType="java.util.Map">
        select count(id) from looker_operation_record
        where 1 = 1
        <if test="projectName != '' ">
            and project_name like '${projectName}%'
        </if>
        <if test="ip != '' ">
            and ip like '${ip}%'
        </if>
    </select>-->

</mapper>
