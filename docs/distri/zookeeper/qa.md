
**问题：Zookeeper是什么？**


**问题：Zookeeper提供了什么**

文件系统，通知机制。

**问题：Zookeeper文件系统**



**问题：Zookeeper的znode节点类型**

持久化节点

持久化顺序节点

临时节点

临时顺序节点


**问题：Zookeeper的通知机制**


**问题：Zookeeper能做什么？**

命名服务，配置管理，集群管理，分布式锁，队列管理。

**问题：Zookeeper的命名服务**


**问题：Zookeeper的配置管理**


**问题：Zookeeper集群管理**


**问题：Zookeeper分布式锁（文件系统，通知机制）**


**问题：获取分布式锁的过程**


**问题：Zookeeper队列管理**

两种队列类型：同步队列，FiFo队列

- 同步队列：当一个队列的成员都聚齐时，这个队列才可用，否则一直等待所有成员到达。在约定目录下创建临时目录节点，监听节点数目是否是我们要求的数目。

- FIFO队列（入队与出队）：和分布式锁服务中的控制时序场景基本原理一致，入列有编号，出列按编号。在特定的目录下创建PERSISTENT_SEQUENTIAL节点（持久顺序节点），
创建成功时Watcher通知等待的队列，队列删除序列号最小的节点用以消费。此场景下Zookeeper的znode用于消息存储，znode存储的数据就是消息队列中的消息内容，
SEQUENTIAL序列号就是消息的编号，按序取出即可。由于创建的节点是持久化的，所以不必担心队列消息的丢失问题。

**问题：Zookeeper数据复制**


**问题：Zookeeper的工作原理**

Zookeeper的核心是原子广播，这个机制保证了各个server之间的同步。实现这个机制的协议叫做Zab协议。Zab协议有两种模式：恢复模式（选主）、广播模式（同步）。

当服务启动或者在领导者崩溃后，Zab就进入了恢复模式，当领导者被选举出来，且大多数Server完成了和leader的状态同步以后，恢复模式就结束了。

状态同步保证了leader和server具有相同的系统状态。


**问题：Zookeeper是如何保证事务的顺序一致性的？**

Zookeeper采用了递增的事务id（zxid）来标识，所有的proposal（提议）都在被提出的时候加上了zxid，zxid实际上是一个64位的数字，高32位是epoch（时期，纪元）用来标识leader是否发生改变，
如果有新的leader产生出来，epoch会自增，低32位用来递增计数。当新产生proposal的时候，会依据数据库的两阶段过程，首先向其他server发出事务执行请求，如果超过半数的机器都能执行并且能够成功，
那么就会执行。

**问题：Zookeeper下server的工作状态**

（1）LOOKING：当前Server不知道leader是谁，正在搜寻。

（2）LEADING：当前Server即为选举出来的leader。

（3）FOLLOWING：leader已经选举出来，当前Server与之同步。


**问题：Zookeeper是如何选取主leader的？**


**问题：Zookeeper同步流程**



**问题：分布式通知和协调**



**问题：机器中为什么会有leader**

在分布式环境中，有些业务逻辑只需要集群中的某一台机器进行执行，其他的机器可以共享这个结果，这样可以大大减少重复计算，提供性能，于是就需要进行leader选举


**问题：ZK节点宕机如何处理？**


**问题：Zookeeper负载均衡和Nginx负载均衡的区别**


**问题：Zookeeper的Watch机制**


**问题：为什么zookeeper集群的数目，一般为奇数个？**

•Leader选举算法采用了Paxos协议；
•Paxos核心思想：当多数Server写成功，则任务数据写成功如果有3个Server，则两个写成功即可；如果有4或5个Server，则三个写成功即可。
•Server数目一般为奇数（3、5、7）如果有3个Server，则最多允许1个Server挂掉；如果有4个Server，则同样最多允许1个Server挂掉由此，

我们看出3台服务器和4台服务器的的容灾能力是一样的，所以为了节省服务器资源，一般我们采用奇数个数，作为服务器部署个数。


**问题：Zookeeper中的脑裂问题**
